# Lab 5 - DevSecOps Foundations with GitHub & SonarCloud

## Overview

This lab is the **foundation lab** for the DevSecOps track.  
By completing Lab 5, a student will be able to:

- Create a GitHub repository from scratch
- Understand basic GitHub repository structure
- Integrate SonarCloud with GitHub
- Configure GitHub Actions CI pipeline
- Secure the CI pipeline using best practices
- Understand how Quality Gates control deployments
- Prepare the environment for upcoming security labs


## Lab Story (Real-World Scenario)

You have just joined a small fintech startup called **TestLab Payments**.

The company is growing fast, and developers push code directly to GitHub.
There is **no security review**, **no quality control**, and **no automated checks**.

Management recently experienced:
- A production outage caused by bad code
- A leaked API key in a public repository
- A third-party dependency with known vulnerabilities

Your mission as a **DevSecOps Engineer** is to:

1. Create a secure GitHub repository
2. Connect it to SonarCloud
3. Enforce code quality and security checks
4. Prevent unsafe code from being deployed

## Prerequisites

Before starting, make sure you have:

- A GitHub account
- A SonarCloud account (free plan is enough)
- Git installed locally
- Basic understanding of Git commands
- A local code editor (VS Code, JetBrains Etc..)

## Step 1 — Create a GitHub Repository

1. Log in to GitHub
2. Click **New Repository**
3. Repository name: `testlab`
4. Visibility: Public
5. Click **Create repository**

You now have an empty GitHub repository.

## Step 2 — Clone the Repository Locally

```bash
git clone git@github.com:<your-username>/testlab.git
cd testlab
```

Check branch:

```bash
git branch
```

Make sure you are on `main`.

## Step 3 — Basic Project Structure

Create the following structure:

```
testlab/
├── .github/
│   └── workflows/
│       └── build.yml
├── src/
│   ├── server.js
│   └── config.js
├── package.json
├── README.md
└── sonar-project.properties
```

Each file has a specific role and will be used later in security labs.

## Step 4 — Create SonarCloud Account & Organization

1. Go to [https://sonarcloud.io](https://sonarcloud.io)
2. Sign in using GitHub
3. Create an Organization linked to your GitHub account
4. Select the repository `testlab`
5. Create a new SonarCloud project

**Important values generated by SonarCloud:**
- Organization key
- Project key
- SonarCloud token

## Step 5 — Generate SonarCloud Token

1. In SonarCloud, go to **My Account → Security**
2. Generate a new token
3. Name it: `testlab`
4. **Copy the token immediately**

This token allows GitHub Actions to authenticate with SonarCloud.

## Step 6 — Add GitHub Secrets

Go to GitHub repository:

```
Settings → Secrets and variables → Actions
```

Create a new Repository Secret:

- **Name:** `SONAR_TOKEN`
- **Value:** `<paste SonarCloud token here>`

This secret will be injected securely at runtime.  
The token is never stored in the code.

## Step 7 — Configure SonarCloud Project File

Create `sonar-project.properties` in the root directory:

```properties
sonar.projectKey=<your-project-key>
sonar.organization=<your-organization-key>
sonar.sourceEncoding=UTF-8
sonar.sources=src
```

This file tells SonarCloud:

- Which project to analyze
- Which organization owns it
- Where the source code is located

## Step 8 — Configure GitHub Actions Pipeline

Create `.github/workflows/build.yml`.

This pipeline will:

1. Run on every push to `main`
2. Run on every Pull Request
3. Scan code with SonarCloud
4. Enforce Quality Gate
5. Allow deployment only if Quality Gate passes

The Quality Gate is the security checkpoint of the pipeline.

## Step 9 — Commit and Push

```bash
git add .
git commit -m "Initial DevSecOps pipeline setup"
git push origin main
```

After pushing:

- GitHub Actions will start automatically
- SonarCloud analysis will run
- Quality Gate result will appear

## Step 10 — Verify the Results

**In GitHub Actions:**
1. Go to **Actions**
2. Open the latest workflow run
3. Status should be **Success**

**In SonarCloud:**
1. Open your project
2. Go to **Main Branch**
3. Verify:
   - **Quality Gate:** Passed
   - **Issues:** 0
   - **Security Hotspots:** 0 (initial state)


## What You Have Achieved

By completing Lab 5, you have:

- Built a real CI pipeline
- Integrated SAST into CI
- Secured secrets properly
- Enforced quality-based deployment
- Created a reusable DevSecOps foundation

This is exactly how modern companies structure secure pipelines.
